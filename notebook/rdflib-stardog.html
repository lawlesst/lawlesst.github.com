<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
 <head>
 <META http-equiv="Content-Type" content="text/html; charset=utf-8">
 <META name="Author" content="Ted Lawless">
     <title>
       Ted Lawless Connecting Python's RDFLib and Stardog
     </title>
	 <link rel="stylesheet" type="text/css" href="../media/style.css">
   <link rel="stylesheet" href="../media/highlight-default.min.css">
   <link rel="stylesheet" href="../media/tomorrow-night-eighties.css">
   <script src="http://yandex.st/highlightjs/7.2/highlight.min.js"></script>
   <script>hljs.initHighlightingOnLoad();</script>
   <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2790298-5']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
   </head>
   <body>
   <div id="header">
        <h1><a href="../">Ted Lawless</a></h1> 
   </div>
   <div id="main">
    <h3>Connecting Python's RDFLib and Stardog</h3>  
    <pre>11-06-14</pre>
    <h2 id="connecting-pythons-rdflib-and-stardog">Connecting Python's RDFLib and Stardog</h2>
<p>For a couple of years I have been working with the Python <a href="https://github.com/RDFLib/rdflib">RDFLib</a> library for converting data from various formats to RDF.  This library serves this work well but it's sometimes difficult to track down a straightforward, working example of performing a particular operation or task in RDFLib.  I have also become interested in learning more about the commercial triple store offerings, which promise better performance and more features than the open source solutions.  A colleague has had good experiences with <a href="http://stardog.com/">Stardog</a>, a commercial semantic graph database (with a freely licensed community edition) from <a href="http://clarkparsia.com/">Clark &amp; Parsia</a>, so I thought I would investigate how to use RDFLib to load data in to Stardog and share my notes.</p>
<p>A "SPARQLStore" and "SPARQLUpdateStore" have been included with Python's <a href="https://github.com/RDFLib/rdflib">RDFLib</a> since version 4.0.  These are designed to allow developers to use the RDFLib code as a client to any SPARQL endpoint.  Since Stardog <a href="http://docs.stardog.com/using/#sd-Querying">supports SPARQL 1.1</a>, developers should be able to connect to Stardog from RDFLib in the similar way they would to other triple stores like <a href="http://rdf4j.org/">Sesame</a> or <a href="http://jena.apache.org/documentation/serving_data/">Fuseki</a>.</p>
<h3 id="setup-stardog">Setup Stardog</h3>
<p>You will need a working instance of Stardog.  Stardog is available under a community license for evaluation after going through a simple registration process.  If you haven't setup Stardog before, you might want to checkout Geir Grnmo's <a href="https://github.com/grove/triplestores">triplestores</a> repository where he has <a href="https://www.vagrantup.com/">Vagrant</a> provisioning scripts for various triple stores.  This is how I got up and running with Stardog.</p>
<p>Once Stardog is installed, start the Stardog server with security disabled.  This will allow the RDFLib code to connect without a username and password.  Obviously you will not want to run Stardog in this way in production but it is convenient for testing.</p>
<p><code>$./bin/stardog-admin server start --disable-security</code></p>
<p>Next create a database called "demo" to store our data.</p>
<p><code>$./bin/stardog-admin db create -n demo</code></p>
<p>At this point a SPARQL endpoint is available at ready for queries at <code>http://localhost:5820/demo/query</code>.</p>
<h3 id="rdf">RDF</h3>
<p>For this example, we'll add three skos:Concepts to a <a href="http://en.wikipedia.org/wiki/Named_graph">named graph</a> in the Stardog store.</p>
<pre><code>@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix skos: &lt;http://www.w3.org/2004/02/skos/core#&gt; .
@prefix xml: &lt;http://www.w3.org/XML/1998/namespace&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

&lt;http://example.org/n1234&gt; a skos:Concept ;
    skos:broader &lt;http://example.org/b5678&gt; ;
    skos:preferredLabel "Baseball" .

&lt;http://example.org/b5678&gt; a skos:Concept ;
    skos:preferredLabel "Sports" .

&lt;http://example.org/n1000&gt; a skos:Concept ;
    skos:preferredLabel "Soccer" .
</code></pre>
<h3 id="code">Code</h3>
<p>The complete example code here is available as a <a href="https://gist.github.com/lawlesst/9996cf3050c019a8d5ee">Gist</a>.</p>
<h5 id="setting-up-the-store">Setting up the 'store'</h5>
<p>We need to initialize a <a href="https://github.com/RDFLib/rdflib/blob/master/rdflib/plugins/stores/sparqlstore.py#L447"><code>SPARQLUpdateStore</code></a> as well as a named graph where we will store our assertions.</p>
<pre><code class="python">    from rdflib import Graph, Literal, URIRef
    from rdflib.namespace import RDF, SKOS
    from rdflib.plugins.stores import sparqlstore

    #Define the Stardog store
    endpoint = 'http://localhost:5820/demo/query'
    store = sparqlstore.SPARQLUpdateStore()
    store.open((endpoint, endpoint))

    #Identify a named graph where we will be adding our instances.
    default_graph = URIRef('http://example.org/default-graph')
    ng = Graph(store, identifier=default_graph)
</code></pre>

<h5 id="loading-assertions-from-a-file">Loading assertions from a file</h5>
<p>We can load our sample turtle file to an in-memory RDFLib graph.</p>
<pre><code class="python">    g = Graph()
    g.parse('./sample-concepts.ttl', format='turtle')

    #Serialize our named graph to make sure we got what we expect.
    print g.serialize(format='turtle')
</code></pre>

<p>Since our data is now loaded as an in memory Graph we can add it to Stardog with a SPARQL INSERT DATA operation.</p>
<pre><code class="python">    ng.update(
    u'INSERT DATA { %s }' % g.serialize(format='nt')
    )
</code></pre>

<h5 id="use-the-rdflib-api-to-inspect-the-data">Use the RDFLib API to inspect the data</h5>
<p>Using the RDFLib API, we can list all the Concepts in the Stardog that were just added.</p>
<pre><code class="python">    for subj in ng.subjects(predicate=RDF.type, object=SKOS.Concept):
        print 'Concept: ', subj
</code></pre>

<p>And, we can find concepts that are broader than others.</p>
<pre><code class="python">    for ob in ng.objects(predicate=SKOS.broader):
        print 'Broader: ', ob
</code></pre>

<h5 id="use-rdflib-to-issue-sparql-read-queries">Use RDFLib to issue SPARQL read queries.</h5>
<p>RDFLib allows for binding a prefix to a namespace.  This makes our queries easier to read and write.</p>
<pre><code class="python">    store.bind('skos', SKOS)
</code></pre>

<p>A SELECT query to get all the <code>skos:preferredLabel</code> for <code>skos:Concepts</code>.</p>
<pre><code class="python">    rq = &quot;&quot;&quot;
    SELECT ?s ?label
    WHERE {
        ?s a skos:Concept ;
           skos:preferredLabel ?label .
    }
    &quot;&quot;&quot;
    for s, l in ng.query(rq):
        print s.n3(), l.n3()
</code></pre>

<h5 id="use-rdflib-to-add-assertions">Use RDFLib to add assertions.</h5>
<p>The RDFLib API can also be used to add new assertions to Stardog.</p>
<pre><code class="python">    soccer = URIRef('http://example.org/n1000')
    ng.add((soccer, SKOS.altLabel, Literal('Football')))
</code></pre>

<p>We can now Read statements about soccer using the RDFLib API, which issues the proper SPARQL query to Stardog in the background.</p>
<pre><code class="python">    for s, p, o in ng.triples((soccer, None, None)):
        print s.n3(), p.n3(), o.n3()
</code></pre>

<h3 id="summary">Summary</h3>
<p>With a little setup, we can begin working with Stardog in RDFLib in a similar way that we work with RDFLib and other backends.  The sample code here is included in this <a href="https://gist.github.com/lawlesst/9996cf3050c019a8d5ee">Gist</a>.</p>
   </div>
   </body>
 </html>
<div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'tedlawlessnotebook'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
